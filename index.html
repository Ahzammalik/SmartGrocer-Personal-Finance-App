    <script>
        // Dashboard Manager - REAL TRANSACTIONS ONLY
        class DashboardManager {
            constructor() {
                this.currencies = {
                    'USD': { symbol: '$', name: 'US Dollar' },
                    'PKR': { symbol: '₨', name: 'Pakistani Rupee' },
                    'INR': { symbol: '₹', name: 'Indian Rupee' }
                };
                this.chart = null;
                this.init();
            }

            init() {
                console.log('🚀 Starting Dashboard Manager - REAL DATA ONLY');
                this.cleanDemoData(); // Remove any demo data
                this.setupEventListeners();
                this.setupCurrencySelection();
                this.checkUserAuth();
                
                // Initial dashboard update
                setTimeout(() => {
                    this.updateDashboard();
                }, 100);
                
                // Auto-update every 5 seconds
                this.setupAutoUpdate();
            }

            cleanDemoData() {
                console.log('🧹 Cleaning any demo data...');
                // Only initialize empty arrays if they don't exist
                const keys = ['expenses', 'income', 'smartgrocer-budgets'];
                keys.forEach(key => {
                    if (!localStorage.getItem(key)) {
                        localStorage.setItem(key, '[]');
                        console.log(`✅ Initialized empty: ${key}`);
                    } else {
                        // Check if there's demo data and remove it
                        const data = JSON.parse(localStorage.getItem(key) || '[]');
                        const hasDemoData = data.some(item => 
                            item.id && (
                                item.id.includes('sample') || 
                                item.id.includes('demo') ||
                                item.description?.includes('Sample') ||
                                item.description?.includes('Demo')
                            )
                        );
                        
                        if (hasDemoData) {
                            console.log(`🗑️ Removing demo data from ${key}`);
                            const realData = data.filter(item => 
                                !item.id.includes('sample') && 
                                !item.id.includes('demo') &&
                                !item.description?.includes('Sample') &&
                                !item.description?.includes('Demo')
                            );
                            localStorage.setItem(key, JSON.stringify(realData));
                        }
                    }
                });
            }

            setupEventListeners() {
                // Listen for data updates from other pages
                window.addEventListener('smartgrocer-data-update', () => {
                    console.log('📊 Dashboard received data update event');
                    this.updateDashboard();
                });

                // Listen for storage changes
                window.addEventListener('storage', (e) => {
                    if (e.key === 'expenses' || e.key === 'income') {
                        console.log('📦 Storage changed, updating dashboard');
                        this.updateDashboard();
                    }
                });

                // Mobile menu
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const sidebar = document.getElementById('sidebar');
                const sidebarOverlay = document.getElementById('sidebar-overlay');
                
                if (mobileMenuButton) {
                    mobileMenuButton.addEventListener('click', () => {
                        sidebar.classList.toggle('-translate-x-full');
                        sidebarOverlay.classList.toggle('hidden');
                    });
                }
                
                if (sidebarOverlay) {
                    sidebarOverlay.addEventListener('click', () => {
                        sidebar.classList.add('-translate-x-full');
                        sidebarOverlay.classList.add('hidden');
                    });
                }

                // Sign in form
                const signinForm = document.getElementById('signin-form');
                if (signinForm) {
                    signinForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handleSignIn();
                    });
                }
            }

            setupAutoUpdate() {
                // Auto-update dashboard every 5 seconds
                setInterval(() => {
                    this.updateDashboard();
                }, 5000);
            }

            setupCurrencySelection() {
                const currencyOptions = document.querySelectorAll('.currency-option');
                currencyOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        currencyOptions.forEach(opt => opt.classList.remove('selected'));
                        option.classList.add('selected');
                        const currency = option.getAttribute('data-currency');
                        localStorage.setItem('selectedCurrency', currency);
                        this.updateCurrencyDisplay();
                        this.updateDashboard();
                    });
                });
            }

            checkUserAuth() {
                const userName = localStorage.getItem('smartgrocer-currentUser');
                if (userName) {
                    this.showMainApp(userName);
                }
            }

            handleSignIn() {
                const userName = document.getElementById('signin-name').value.trim();
                const selectedCurrency = document.querySelector('.currency-option.selected')?.getAttribute('data-currency') || 'PKR';
                
                if (userName) {
                    localStorage.setItem('smartgrocer-currentUser', userName);
                    localStorage.setItem('selectedCurrency', selectedCurrency);
                    this.showMainApp(userName);
                    this.showNotification(`Welcome to SmartGrocer, ${userName}!`, 'success');
                }
            }

            showMainApp(userName) {
                document.getElementById('signin-overlay').style.display = 'none';
                document.getElementById('main-app-container').classList.remove('hidden');
                document.getElementById('user-greeting').textContent = `Hello, ${userName}!`;
                document.getElementById('user-initial').textContent = userName.charAt(0).toUpperCase();
                this.updateCurrencyDisplay();
            }

            updateCurrencyDisplay() {
                const currency = localStorage.getItem('selectedCurrency') || 'PKR';
                const currencyInfo = this.currencies[currency];
                if (currencyInfo) {
                    document.getElementById('current-currency').textContent = currency;
                    document.getElementById('currency-symbol').textContent = currencyInfo.symbol;
                }
            }

            updateDashboard() {
                console.log('🔄 Updating dashboard with REAL USER DATA...');
                try {
                    const expenses = this.getRealTransactions('expenses');
                    const income = this.getRealTransactions('income');
                    const budgets = this.getData('smartgrocer-budgets');
                    const transactions = [...expenses, ...income];
                    
                    console.log('📊 REAL USER DATA:', {
                        expenses: expenses.length,
                        income: income.length,
                        transactions: transactions.length
                    });

                    // Show detailed transaction info
                    if (transactions.length > 0) {
                        console.log('💳 User Transactions:', transactions);
                    }

                    const financialData = this.calculateFinancialData(transactions);
                    this.updateFinancialOverview(financialData);
                    this.updateBudgetProgress(budgets, transactions);
                    this.updateRecentTransactions(transactions);
                    this.updateSpendingChart(transactions);
                    this.updateDataStatus(transactions);
                    
                } catch (error) {
                    console.error('Error updating dashboard:', error);
                }
            }

            getData(key) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    return [];
                }
            }

            getRealTransactions(key) {
                const transactions = this.getData(key);
                // Filter out any demo/sample transactions
                return transactions.filter(transaction => 
                    !transaction.id?.includes('sample') && 
                    !transaction.id?.includes('demo') &&
                    !transaction.description?.includes('Sample') &&
                    !transaction.description?.includes('Demo') &&
                    !transaction.description?.includes('Grocery Shopping') && // Common demo data
                    !transaction.description?.includes('Monthly Salary') // Common demo data
                );
            }

            calculateFinancialData(transactions) {
                const currency = localStorage.getItem('selectedCurrency') || 'PKR';
                const currencySymbol = this.currencies[currency]?.symbol || '₨';
                
                console.log('🧮 Calculating from', transactions.length, 'REAL transactions');

                // Calculate from REAL user transactions only
                const totalIncome = transactions
                    .filter(t => t.type === 'income')
                    .reduce((total, t) => total + (parseFloat(t.amount) || 0), 0);

                const totalExpenses = transactions
                    .filter(t => t.type === 'expense')
                    .reduce((total, t) => total + Math.abs(parseFloat(t.amount) || 0), 0);

                // TOTAL BALANCE = Total Income - Total Expenses
                const totalBalance = totalIncome - totalExpenses;

                // Current month calculations from real data only
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                
                const currentMonthTransactions = transactions.filter(t => {
                    try {
                        const date = new Date(t.date || t.timestamp);
                        return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
                    } catch {
                        return false;
                    }
                });

                const monthlyIncome = currentMonthTransactions
                    .filter(t => t.type === 'income')
                    .reduce((total, t) => total + (parseFloat(t.amount) || 0), 0);

                const monthlyExpenses = currentMonthTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((total, t) => total + Math.abs(parseFloat(t.amount) || 0), 0);

                const savingsRate = monthlyIncome > 0 ? 
                    Math.max(Math.round(((monthlyIncome - monthlyExpenses) / monthlyIncome) * 100), 0) : 0;

                const result = {
                    totalBalance,
                    totalIncome: monthlyIncome,
                    totalExpenses: monthlyExpenses,
                    savingsRate,
                    symbol: currencySymbol
                };

                console.log('💰 REAL Financial Overview:', result);
                return result;
            }

            updateFinancialOverview(data) {
                document.getElementById('total-balance').textContent = `${data.symbol}${data.totalBalance.toLocaleString()}`;
                document.getElementById('total-income').textContent = `${data.symbol}${data.totalIncome.toLocaleString()}`;
                document.getElementById('total-expenses').textContent = `${data.symbol}${data.totalExpenses.toLocaleString()}`;
                document.getElementById('savings-rate').textContent = `${data.savingsRate}%`;
            }

            updateBudgetProgress(budgets, transactions) {
                const container = document.getElementById('budget-progress-container');
                if (!container) return;

                if (budgets.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-chart-pie text-3xl mb-3 opacity-40"></i>
                            <p>No budgets set yet</p>
                            <p class="text-sm mt-2">Create budgets to track your real spending</p>
                        </div>
                    `;
                    return;
                }

                const currencySymbol = this.currencies[localStorage.getItem('selectedCurrency') || 'PKR']?.symbol || '₨';
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();

                container.innerHTML = budgets.map(budget => {
                    const spent = transactions
                        .filter(t => {
                            try {
                                const date = new Date(t.date || t.timestamp);
                                return t.type === 'expense' && 
                                       t.category === budget.category &&
                                       date.getMonth() === currentMonth &&
                                       date.getFullYear() === currentYear;
                            } catch {
                                return false;
                            }
                        })
                        .reduce((total, t) => total + Math.abs(parseFloat(t.amount) || 0), 0);
                    
                    const percentage = budget.amount > 0 ? Math.min((spent / budget.amount) * 100, 100) : 0;
                    const progressColor = percentage > 90 ? 'bg-red-500' : 
                                       percentage > 75 ? 'bg-yellow-500' : 'bg-green-500';
                    
                    return `
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium text-gray-700">${budget.name}</span>
                                <span class="text-sm text-gray-500">${currencySymbol}${spent.toFixed(0)} / ${currencySymbol}${budget.amount}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill ${progressColor}" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            updateRecentTransactions(transactions) {
                const container = document.getElementById('recent-transactions-container');
                if (!container) return;

                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                
                const recentTransactions = transactions
                    .filter(t => {
                        try {
                            const date = new Date(t.date || t.timestamp);
                            return date >= oneWeekAgo;
                        } catch {
                            return false;
                        }
                    })
                    .sort((a, b) => new Date(b.date || b.timestamp) - new Date(a.date || a.timestamp))
                    .slice(0, 5);

                const currencySymbol = this.currencies[localStorage.getItem('selectedCurrency') || 'PKR']?.symbol || '₨';

                if (recentTransactions.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-exchange-alt text-3xl mb-3 opacity-40"></i>
                            <p>No recent transactions</p>
                            <p class="text-sm mt-2">Your real transactions from the last 7 days will appear here</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = recentTransactions.map(transaction => {
                    const isExpense = transaction.type === 'expense';
                    const amountClass = isExpense ? 'text-red-500' : 'text-green-500';
                    const amountSign = isExpense ? '-' : '+';
                    const absoluteAmount = Math.abs(transaction.amount);
                    
                    const iconClass = this.getTransactionIcon(transaction.category);
                    const timeAgo = this.getTimeAgo(new Date(transaction.date || transaction.timestamp));
                    
                    return `
                        <div class="transaction-item flex justify-between items-center p-3 rounded-lg border border-gray-100">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 ${iconClass.bg} rounded-full flex items-center justify-center">
                                    <i class="${iconClass.icon} ${iconClass.color}"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-800">${transaction.description || transaction.category}</p>
                                    <p class="text-gray-500 text-xs">${transaction.category} • ${timeAgo}</p>
                                </div>
                            </div>
                            <span class="${amountClass} font-bold">${amountSign}${currencySymbol}${absoluteAmount.toLocaleString()}</span>
                        </div>
                    `;
                }).join('');
            }

            updateSpendingChart(transactions) {
                const ctx = document.getElementById('spendingChart');
                if (!ctx) return;

                if (this.chart) {
                    this.chart.destroy();
                }

                const currencySymbol = this.currencies[localStorage.getItem('selectedCurrency') || 'PKR']?.symbol || '₨';
                const chartData = this.calculateChartData(transactions);

                if (chartData.expenses.some(expense => expense > 0)) {
                    this.chart = new Chart(ctx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: chartData.labels,
                            datasets: [{
                                label: 'Spending',
                                data: chartData.expenses,
                                borderColor: '#10B981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: (value) => `${currencySymbol}${value.toLocaleString()}`
                                    }
                                }
                            }
                        }
                    });
                } else {
                    // Show empty state for chart
                    ctx.parentElement.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-chart-line text-3xl mb-3 opacity-40"></i>
                            <p>No spending data available</p>
                            <p class="text-sm mt-2">Add real expenses to see your spending chart</p>
                        </div>
                    `;
                }
            }

            calculateChartData(transactions) {
                const months = [];
                const expenseData = [];
                const currentDate = new Date();

                for (let i = 5; i >= 0; i--) {
                    const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                    const monthName = date.toLocaleString('default', { month: 'short' });
                    months.push(monthName);

                    const monthExpenses = transactions
                        .filter(t => {
                            try {
                                const transactionDate = new Date(t.date || t.timestamp);
                                return t.type === 'expense' &&
                                       transactionDate.getMonth() === date.getMonth() &&
                                       transactionDate.getFullYear() === date.getFullYear();
                            } catch {
                                return false;
                            }
                        })
                        .reduce((total, t) => total + Math.abs(parseFloat(t.amount) || 0), 0);

                    expenseData.push(monthExpenses);
                }

                return { labels: months, expenses: expenseData };
            }

            updateDataStatus(transactions) {
                const statusElement = document.getElementById('data-status');
                if (!statusElement) return;

                if (transactions.length === 0) {
                    statusElement.classList.remove('hidden');
                    statusElement.innerHTML = `
                        <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                        <span class="text-blue-700 text-sm flex-1">No transactions yet. Add real income or expenses to see your financial overview.</span>
                        <div class="flex space-x-2">
                            <a href="income.html" class="refresh-btn">
                                <i class="fas fa-plus mr-1"></i>Add Income
                            </a>
                            <a href="expense.html" class="refresh-btn" style="background-color: #3B82F6;">
                                <i class="fas fa-minus mr-1"></i>Add Expense
                            </a>
                        </div>
                    `;
                } else {
                    statusElement.classList.add('hidden');
                }
            }

            getTransactionIcon(category) {
                const icons = {
                    'Food & Dining': { icon: 'fas fa-utensils', color: 'text-green-600', bg: 'bg-green-100' },
                    'Transportation': { icon: 'fas fa-car', color: 'text-blue-600', bg: 'bg-blue-100' },
                    'Shopping': { icon: 'fas fa-shopping-bag', color: 'text-purple-600', bg: 'bg-purple-100' },
                    'Entertainment': { icon: 'fas fa-film', color: 'text-yellow-600', bg: 'bg-yellow-100' },
                    'Bills & Utilities': { icon: 'fas fa-file-invoice-dollar', color: 'text-red-600', bg: 'bg-red-100' },
                    'Healthcare': { icon: 'fas fa-heartbeat', color: 'text-pink-600', bg: 'bg-pink-100' },
                    'Education': { icon: 'fas fa-graduation-cap', color: 'text-indigo-600', bg: 'bg-indigo-100' },
                    'Salary': { icon: 'fas fa-money-bill-wave', color: 'text-green-600', bg: 'bg-green-100' },
                    'Other': { icon: 'fas fa-wallet', color: 'text-gray-600', bg: 'bg-gray-100' }
                };
                return icons[category] || { icon: 'fas fa-wallet', color: 'text-gray-600', bg: 'bg-gray-100' };
            }

            getTimeAgo(date) {
                const now = new Date();
                const diffInMs = now - date;
                const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));
                
                if (diffInDays === 0) return 'Today';
                if (diffInDays === 1) return 'Yesterday';
                if (diffInDays < 7) return `${diffInDays}d ago`;
                return date.toLocaleDateString();
            }

            showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                if (!notification) return;
                
                const bgColor = type === 'success' ? 'bg-green-500' : 'bg-blue-500';
                
                notification.innerHTML = `
                    <div class="${bgColor} text-white p-4 rounded-lg flex items-center justify-between">
                        <div class="flex items-center">
                            <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-info-circle'} mr-3"></i>
                            <span>${message}</span>
                        </div>
                        <button onclick="this.parentElement.parentElement.classList.add('hidden')" class="ml-4 text-white hover:text-gray-200">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                notification.classList.remove('hidden');
                setTimeout(() => notification.classList.add('hidden'), 3000);
            }
        }

        // Global function for manual refresh
        function updateDashboard() {
            if (window.dashboard) {
                window.dashboard.updateDashboard();
                showNotification('Dashboard refreshed with real data!', 'success');
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-blue-500';
            
            notification.innerHTML = `
                <div class="${bgColor} text-white p-4 rounded-lg flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-info-circle'} mr-3"></i>
                        <span>${message}</span>
                    </div>
                    <button onclick="this.parentElement.parentElement.classList.add('hidden')" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            notification.classList.remove('hidden');
            setTimeout(() => notification.classList.add('hidden'), 3000);
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🏠 Starting dashboard - REAL DATA ONLY');
            window.dashboard = new DashboardManager();
        });
    </script>
